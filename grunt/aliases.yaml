# default:
#   - 'debug'

# build:
#   - 'coffee:scripts'
#   - 'sass:styles'

# watch:
#   - 'watch:'

default: 'server'

server:
  description: 'Run a webserver to view local changes in real-time.'
  tasks:
  - 'compile'
  - 'connect:server'
  - 'watch'

compile:
  description: 'Compile all assets from the src folder into the app folder.'
  tasks:
  - 'coffee:scripts'
  - 'coffee:tests'
  - 'sass:styles'

lint:
  description: 'Lint all scripts and styles, including tests.'
  tasks:
    - 'coffeelint:scripts'
    - 'scsslint:styles'
    - 'coffeelint:tests'

test:
  description: 'Run the test suite once.'
  tasks:
    - 'lint'
    - 'compile'
    - 'mochaTest'

docs:
  description: 'Look at the existing documenation.'
  tasks:
    - 'connect:docs'

build-files:
  description: 'Builds all code from source.'
  tasks:
    - 'test'                # compile and test all assets
    - 'clean:dist'          # delete the dist directory
    - 'copy:dist'           # copy everything from app to dist except scripts and styles
    - 'useminPrepare:dist'  # create concat/minify/uglify configs from the blocks in dist html files
    - 'concat:generated'    # concatenate scripts and styles
    - 'cssmin:generated'    # minifiy css
    - 'uglify:generated'    # uglify js
    - 'usemin:dist'         # copy the generated files back to dist
    - 'clean:tmp'           # delete the temporary usemin files we just copied

build-documentation:
  description: 'Regenerates all code documentation.'
  tasks:
  - 'changelog'           # generate/update the changelog
  - 'styleguide'          # generate/update the styleguide
  - 'markdown:docs'       # convert markdown documents to html

build:
  description: 'Create a production-ready release in the dist folder.'
  tasks:
    - 'build-files'
    - 'bump-only:patch'          # increment the patch number
    - 'build-documentation'
    - 'bump-commit'

build-major:
  description: 'Create a production-ready release in the dist folder, incrementing the major version number.'
  tasks:
    - 'build-files'
    - 'bump-only:major'          # increment the major number
    - 'build-documentation'
    - 'bump-commit'

build-minor:
  description: 'Create a production-ready release in the dist folder, incrementing the minor version number.'
  tasks:
    - 'build-files'
    - 'bump-only:minor'          # increment the minor number
    - 'build-documentation'
    - 'bump-commit'

build-prerelease:
  description: 'Create a production-ready release in the dist folder, incrementing the prerelease version number.'
  tasks:
    - 'build-files'
    - 'bump-only:prerelease'          # increment the prerelease number
    - 'build-documentation'
    - 'bump-commit'
